"use strict";

require("../common");

var _steps = require("cypress-cucumber-preprocessor/steps");

(0, _steps.Given)('a SingleSelect with hidden sibling elements', () => {
  cy.visitStory('SingleSelect', 'Menu width changing');
  cy.get('[data-test="dhis2-uicore-singleselect"]').then($el => {
    cy.wrap($el.outerWidth()).as('originalWidth');
  });
});
(0, _steps.When)('the button is clicked', () => {
  cy.get('button').click();
});
(0, _steps.Then)('the siblings are displayed', () => {
  cy.get('.toggler').should('exist').and('have.length', 2);
});
(0, _steps.Then)('the menu width has decreased', () => {
  cy.get('[data-test="dhis2-uicore-singleselect"]').then($el => {
    const newWidth = $el.outerWidth();
    cy.get('@originalWidth').should('be.greaterThan', newWidth);
  });
});
(0, _steps.When)('the SingleSelect menu is open', () => {
  cy.get('[data-test="dhis2-uicore-select-menu-menuwrapper"]').should('be.visible');
});
(0, _steps.Then)('the SingleSelect input is left aligned with the menu', () => {
  const selectDataTest = '[data-test="dhis2-uicore-singleselect"]';
  const menuDataTest = '[data-test="dhis2-uicore-select-menu-menuwrapper"]';
  cy.getAll(selectDataTest, menuDataTest).should(([inputs, menus]) => {
    expect(inputs.length).to.equal(1);
    expect(menus.length).to.equal(1);
    const $input = inputs[0];
    const $menu = menus[0];
    const inputRect = $input.getBoundingClientRect();
    const menuRect = $menu.getBoundingClientRect();
    expect(Math.round(inputRect.left)).to.equal(Math.round(menuRect.left));
  });
});
(0, _steps.When)('the SingleSelect input and menu have the same width', () => {
  const inputSelector = '[data-test="dhis2-uicore-select"]';
  const menuSelector = '[data-test="dhis2-uicore-select-menu-menuwrapper"]';
  cy.getAll(inputSelector, menuSelector).should(([$input, $menu]) => {
    const inputWidth = Math.round($input.outerWidth());
    const menuWidth = Math.round($menu.outerWidth());
    expect(inputWidth).to.equal(menuWidth);
  });
});